for (i in 1:4) {
# Initialisation des données
bugs.data = list(
nyears = nyears,
y = c(CMRi[[i]]$N, rep(NA, 2)),
dH = dH[i],
h = harvest
)
# Paramètres jags
bugs.monitor = c("lambda", "sigmaProc", "N", "tauProc")
bugs.chains = 3
bugs.inits = function() {
list()
}
# Lancement du modèle
wolf_modelexp = jags(data = bugs.data,
inits = bugs.inits,
parameters.to.save = bugs.monitor,
model.file = modelexp,
n.chains = bugs.chains,
n.thin=10,
n.iter=100000,
n.burnin=50000)
if (i==1){
print(wolf_modelexp$BUGSoutput)
output1 = wolf_modelexp$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter1") %>%
filter(str_detect(parameter1, "N")) %>%
group_by(parameter1) %>%
summarize(medianN1 = median(value),
lq1 = quantile(value, probs = 2.5/100),
hq1 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter1) + 1995)%>%
arrange(years)%>%
mutate(ObsY = bugs.data$y)
}
if(i==2){
output2 = wolf_modelexp$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter2") %>%
filter(str_detect(parameter2, "N")) %>%
group_by(parameter2) %>%
summarize(medianN2 = median(value),
lq2 = quantile(value, probs = 2.5/100),
hq2 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter2) + 1995)%>%
arrange(years)
}
if(i==3){
output3 = wolf_modelexp$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter3") %>%
filter(str_detect(parameter3, "N")) %>%
group_by(parameter3) %>%
summarize(medianN3 = median(value),
lq3 = quantile(value, probs = 2.5/100),
hq3 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter3) + 1995)%>%
arrange(years)
}
if(i==4){
output4 = wolf_modelexp$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter4") %>%
filter(str_detect(parameter4, "N")) %>%
group_by(parameter4) %>%
summarize(medianN4 = median(value),
lq4 = quantile(value, probs = 2.5/100),
hq4 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter4) + 1995)%>%
arrange(years)
}
}
outputexp = output1 %>% left_join(output2) %>%
left_join(output3) %>%
left_join(output4) %>%
pivot_longer(
c(medianN1, medianN2, medianN3, medianN4),
names_to = "medianN",
values_to = "valuesM")
variable_names <- list(
"medianN1" = "Harvest : 0%" ,
"medianN2" = "Harvest : 10%",
"medianN3" = "Harvest : 20%",
"medianN4" = "Harvest : 30%")
variable_labeller <- function(variable, value) {
return(variable_names[value])
}
ggplot(outputexp)+
geom_point(aes(x = years, y = ObsY)) +
coord_cartesian(xlim=c(1996,2024),ylim=c(0,1000))+
aes(x = years, y = valuesM)+
geom_line(colour = "red", lty = "dashed")+
geom_ribbon(aes(x = years, ymin = lq1, ymax = hq1), fill = "red", alpha = 0.3)+
facet_wrap(~medianN,labeller = variable_labeller)+
theme_bw()+
labs(title = "Estimated and projected population size for each harest rate",
x = "Years",
y = "Number of wolves")
modellogist = function() {
# Priors
sigmaProc ~ dunif (0, 5)
tauProc = 1 / sigmaProc ^ 2
alpha ~ dunif(0, 1.0986) #maximum exponential growth rate
K ~ dunif(1, 1000)         #carrying capacity
N[1] ~ dgamma(1.0E-6, 1.0E-6)
# Process model
for (t in 2:(nyears)) {
u[t-1] = N[t-1] - h[t-1]
Er[t] = exp(alpha * (1 - u[t-1] / K)) # per capita growth rate is density dependent - Ricker model
lambda[t] = u[t-1] * Er[t]
NProc[t] = log(max(1, lambda[t]))
N[t] ~ dlnorm(NProc[t], tauProc)
}
# Observation model
for (t in 1:(nyears)) {
y[t] ~ dpois(N[t])
}
#Projected population
for (t in (nyears+1):(nyears+2)) {
u[t-1] = (1-dH) * N[t-1]
Er[t] = exp(alpha * (1 - u[t-1] / K)) # per capita growth rate is density dependent - Ricker model
lambda[t] = u[t-1] * Er[t]
NProc[t] = log(max(1, lambda[t]))
N[t] ~ dlnorm(NProc[t], tauProc)
}
}
for (i in 1:4) {
# Initialisation des données
bugs.data = list(
nyears = nyears,
y = c(CMRi[[i+4]]$N, rep(NA, 2)),
dH = dH[i],
h = harvest
)
# Paramètres jags
bugs.monitor = c("alpha", "sigmaProc", "tauProc", "K", "N")
bugs.chains = 3
init1 = list(alpha = .5, sigmaProc = .25)
init2 = list(alpha = .1, sigmaProc = .05)
init3 = list(alpha = 1, sigmaProc = .45)
bugs.inits = list(init1, init2, init3)
# Lancement du modèle
wolf_modellogist = jags(data = bugs.data,
inits = bugs.inits,
parameters.to.save = bugs.monitor,
model.file = modellogist,
n.chains = bugs.chains,
n.thin=10,
n.iter=100000,
n.burnin=50000)
if (i==1){
output1 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter1") %>%
filter(str_detect(parameter1, "N")) %>%
group_by(parameter1) %>%
summarize(medianN1 = median(value),
lq1 = quantile(value, probs = 2.5/100),
hq1 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter1) + 1995)%>%
arrange(years)%>%
mutate(ObsY = bugs.data$y)
}
if(i==2){
output2 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter2") %>%
filter(str_detect(parameter2, "N")) %>%
group_by(parameter2) %>%
summarize(medianN2 = median(value),
lq2 = quantile(value, probs = 2.5/100),
hq2 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter2) + 1995)%>%
arrange(years)
}
if(i==3){
output3 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter3") %>%
filter(str_detect(parameter3, "N")) %>%
group_by(parameter3) %>%
summarize(medianN3 = median(value),
lq3 = quantile(value, probs = 2.5/100),
hq3 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter3) + 1995)%>%
arrange(years)
}
if(i==4){
output4 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter4") %>%
filter(str_detect(parameter4, "N")) %>%
group_by(parameter4) %>%
summarize(medianN4 = median(value),
lq4 = quantile(value, probs = 2.5/100),
hq4 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter4) + 1995)%>%
arrange(years)
}
}
wolf_modelCMR$BUGSoutput
outputlogi = output1 %>% left_join(output2) %>%
left_join(output3) %>%
left_join(output4) %>%
pivot_longer(
c(medianN1, medianN2, medianN3, medianN4),
names_to = "medianN",
values_to = "valuesM")
variable_names <- list(
"medianN1" = "Harvest : 0%" ,
"medianN2" = "Harvest : 10%",
"medianN3" = "Harvest : 20%",
"medianN4" = "Harvest : 30%")
variable_labeller <- function(variable, value) {
return(variable_names[value])
}
ggplot(outputlogi)+
geom_point(aes(x = years, y = ObsY)) +
coord_cartesian(xlim=c(1996,2024),ylim=c(0,1000))+
aes(x = years, y = valuesM)+
geom_line(colour = "red", lty = "dashed")+
geom_ribbon(aes(x = years, ymin = lq1, ymax = hq1), fill = "red", alpha = 0.3)+
facet_wrap(~medianN,labeller = variable_labeller)+
theme_bw()+
labs(title = "Estimated and projected population size for each harest rate",
x = "Years",
y = "Number of wolves")
output1
View(output1)
for (i in 1:4) {
# Initialisation des données
bugs.data = list(
nyears = nyears,
y = c(CMRi[[i+4]]$N, rep(NA, 2)),
dH = dH[i],
h = harvest
)
# Paramètres jags
bugs.monitor = c("alpha", "sigmaProc", "tauProc", "K", "N")
bugs.chains = 3
init1 = list(alpha = .5, sigmaProc = .25)
init2 = list(alpha = .1, sigmaProc = .05)
init3 = list(alpha = 1, sigmaProc = .45)
bugs.inits = list(init1, init2, init3)
# Lancement du modèle
wolf_modellogist = jags(data = bugs.data,
inits = bugs.inits,
parameters.to.save = bugs.monitor,
model.file = modellogist,
n.chains = bugs.chains,
n.thin=10,
n.iter=100000,
n.burnin=50000)
if (i==1){
print(wolf_modellogist$BUGSoutput,intervals = c(2.5/100, 50/100, 97.5/100))
output1 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter1") %>%
filter(str_detect(parameter1, "N")) %>%
group_by(parameter1) %>%
summarize(medianN1 = median(value),
lq1 = quantile(value, probs = 2.5/100),
hq1 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter1) + 1995)%>%
arrange(years)%>%
mutate(ObsY = bugs.data$y)
}
if(i==2){
output2 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter2") %>%
filter(str_detect(parameter2, "N")) %>%
group_by(parameter2) %>%
summarize(medianN2 = median(value),
lq2 = quantile(value, probs = 2.5/100),
hq2 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter2) + 1995)%>%
arrange(years)
}
if(i==3){
output3 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter3") %>%
filter(str_detect(parameter3, "N")) %>%
group_by(parameter3) %>%
summarize(medianN3 = median(value),
lq3 = quantile(value, probs = 2.5/100),
hq3 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter3) + 1995)%>%
arrange(years)
}
if(i==4){
output4 = wolf_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),  values_to = "value", names_to = "parameter4") %>%
filter(str_detect(parameter4, "N")) %>%
group_by(parameter4) %>%
summarize(medianN4 = median(value),
lq4 = quantile(value, probs = 2.5/100),
hq4 = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter4) + 1995)%>%
arrange(years)
}
}
knitr::opts_chunk$set(echo = TRUE)
nyears = 28
N1 = 30
sigma = 0.2
K = 800
alpha = 0.3
ssm_sim2 = data.frame(Year = 1:nyears,
y = numeric(nyears),
N = numeric(nyears))
ssm_sim2$N[1] = N1
for (t in 1:(nyears-1)){
Er = exp(alpha * (1 - ssm_sim2$N[t] / K)) * ssm_sim2$N[t]
ssm_sim2$N[t+1] = rpois(1,Er)
}
for (t in 1:nyears){
ssm_sim2$y[t]=rpois(1,ssm_sim2$N[t])
}
ggplot(ssm_sim2, aes(x = Year)) +
geom_point(aes(y = y), colour = "red") +
geom_line(aes(y = N), colour = "grey30") +
theme_bw()
modellogist = function() {
# Priors
sigmaProc ~ dunif (0, 10)
tauProc = 1 / sigmaProc ^ 2
alpha ~ dunif(0, 1.0986) #maximum exponential growth rate
K ~ dunif(1, 1000)         #carrying capacity
N[1] ~ dgamma(1.0E-6, 1.0E-6)
# Process model
for (t in 2:(nyears)) {
Er[t-1] = exp(alpha * (1 - N[t-1] / K))
lambda[t-1] = N[t-1] * Er[t-1]
N[t] ~ dpois(lambda[t-1])
}
# Observation model
for (t in 1:nyears) {
y[t] ~ dpois(N[t])
}
}
bugs.data = list(nyears = nrow(ssm_sim2)+20,
y = c(ssm_sim2$y,rep(NA,20)))
bugs.monitor = c("alpha", "sigmaProc", "tauProc", "K", "lambda", "N")
bugs.chains = 3
init1 = list(alpha = .5, sigmaProc = .25)
init2 = list(alpha = .1, sigmaProc = .05)
init3 = list(alpha = 1, sigmaProc = .45)
bugs.inits = list(init1, init2, init3)
sim_modellogist = jags(data = bugs.data,
inits = bugs.inits,
parameters.to.save = bugs.monitor,
model.file = modellogist,
n.chains = bugs.chains,
n.thin=10,
n.iter=20000,
n.burnin=5000)
sim_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),
values_to = "value",
names_to = "parameter") %>%
filter(str_detect(parameter, "N")) %>%
group_by(parameter) %>%
summarize(medianN = median(value),
lq = quantile(value, probs = 2.5/100),
hq = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter) + 1995)%>%
arrange(years)%>%
ggplot()+
geom_line(aes(x = years, y = medianN), colour = "red", lty = "dashed")+
geom_ribbon(aes(x = years, ymin = lq, ymax = hq), fill = "red", alpha = 0.3)+
geom_point(data = bugs.data %>% as_tibble, aes(x = 1995 + 1:unique(nyears), y = y)) +
coord_cartesian(xlim=c(1996,2040))+
theme_bw()+
labs(title = "Estimated and projected population size",
subtitle = "with observed population size (black dots)",
x = "Years",
y = "Number of wolves")
nyears = 27
N1 = 30
sigma = 0.15
lambda = 1.3
K = 800
alpha = 0.3
ssm_sim3 = data.frame(Year = 1:nyears,
y = numeric(nyears),
N = numeric(nyears))
ssm_sim3$N[1] = N1
# Modèle exponentiel
for (t in 1:14){
ssm_sim3$N[t+1] = round(rnorm(1,ssm_sim3$N[t] * lambda,sigma))
}
for (t in 1:15){
ssm_sim3$y[t]=rpois(1,ssm_sim3$N[t])
}
# Modèle logistique
for (t in 15:nyears){
Er = exp(alpha * (1 - ssm_sim3$N[t-1] / K)) * ssm_sim3$N[t-1]
ssm_sim3$N[t] = rpois(1,Er)
}
for (t in 16:nyears){
ssm_sim3$y[t]=rpois(1,ssm_sim3$N[t])
}
ggplot(ssm_sim3, aes(x = Year)) +
geom_point(aes(y = y), colour = "red") +
geom_line(aes(y = N), colour = "grey30") +
theme_bw()
nyears = 27
N1 = 30
sigma = 0.15
lambda = 1.15
K = 800
alpha = 0.3
ssm_sim3 = data.frame(Year = 1:nyears,
y = numeric(nyears),
N = numeric(nyears))
ssm_sim3$N[1] = N1
# Modèle exponentiel
for (t in 1:14){
ssm_sim3$N[t+1] = round(rnorm(1,ssm_sim3$N[t] * lambda,sigma))
}
for (t in 1:15){
ssm_sim3$y[t]=rpois(1,ssm_sim3$N[t])
}
# Modèle logistique
for (t in 15:nyears){
Er = exp(alpha * (1 - ssm_sim3$N[t-1] / K)) * ssm_sim3$N[t-1]
ssm_sim3$N[t] = rpois(1,Er)
}
for (t in 16:nyears){
ssm_sim3$y[t]=rpois(1,ssm_sim3$N[t])
}
ggplot(ssm_sim3, aes(x = Year)) +
geom_point(aes(y = y), colour = "red") +
geom_line(aes(y = N), colour = "grey30") +
theme_bw()
modellogist = function() {
# Priors
sigmaProc ~ dunif (0, 10)
tauProc = 1 / sigmaProc ^ 2
alpha ~ dunif(0, 1.0986) #maximum exponential growth rate
K ~ dunif(1, 1000)         #carrying capacity
N[1] ~ dgamma(1.0E-6, 1.0E-6)
# Process model
for (t in 2:(nyears-20)) {
Er[t-1] = exp(alpha * (1 - N[t-1] / K))
lambda[t-1] = N[t-1] * Er[t-1]
N[t] ~ dpois(lambda[t-1])
}
# Observation model
for (t in 1:nyears) {
y[t] ~ dpois(N[t])
}
# Projection
for (t in (nyears-19):(nyears)) {
Er[t-1] = exp(alpha * (1 - N[t-1] / K))
lambda[t-1] = N[t-1] * Er[t-1]
N[t] ~ dpois(lambda[t-1])
}
}
bugs.data = list(nyears = nrow(ssm_sim3)+20,
y = c(ssm_sim3$y,rep(NA,20)))
bugs.monitor = c("alpha", "sigmaProc", "tauProc", "K", "lambda", "N")
bugs.chains = 3
init1 = list(alpha = .5, sigmaProc = .25)
init2 = list(alpha = .1, sigmaProc = .05)
init3 = list(alpha = 1, sigmaProc = .45)
bugs.inits = list(init1, init2, init3)
sim_modellogist = jags(data = bugs.data,
inits = bugs.inits,
parameters.to.save = bugs.monitor,
model.file = modellogist,
n.chains = bugs.chains,
n.thin=10,
n.iter=20000,
n.burnin=5000)
sim_modellogist$BUGSoutput$sims.matrix %>%
as_tibble() %>%
pivot_longer(cols = everything(),
values_to = "value",
names_to = "parameter") %>%
filter(str_detect(parameter, "N")) %>%
group_by(parameter) %>%
summarize(medianN = median(value),
lq = quantile(value, probs = 2.5/100),
hq = quantile(value, probs = 97.5/100))%>%
mutate(years = parse_number(parameter) + 1995)%>%
arrange(years)%>%
ggplot()+
geom_line(aes(x = years, y = medianN), colour = "red", lty = "dashed")+
geom_ribbon(aes(x = years, ymin = lq, ymax = hq), fill = "red", alpha = 0.3)+
geom_point(data = bugs.data %>% as_tibble, aes(x = 1995 + 1:unique(nyears), y = y)) +
coord_cartesian(xlim=c(1996,2040))+
theme_bw()+
labs(title = "Estimated population size",
subtitle = "Observed population size (black dots)",
x = "Years",
y = "Number of wolves")
print(wolf_modelCMR$BUGSoutput,intervals = c(2.5/100, 50/100, 97.5/100))
print(wolf_modelCMR$BUGSoutput,intervals = c(2.5/100, 50/100, 97.5/100))
print(wolf_modelCMR$BUGSoutput,intervals = c(2.5/100, 50/100, 97.5/100))
print(wolf_modelCMR$BUGSoutput, intervals = c(2.5/100, 50/100, 97.5/100))
N
output1
harvest/output1
harvest/output1$medianN1
1996+18
